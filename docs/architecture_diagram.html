<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenLiberty RealWorld - Architecture Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            text-align: center;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 1.4em;
            margin-bottom: 2px;
            font-weight: 600;
        }

        .header p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .zoom-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            padding: 8px 20px;
            border-bottom: 1px solid #dee2e6;
            flex-shrink: 0;
        }

        .status-message {
            font-size: 12px;
            font-weight: 500;
        }

        .status-positive {
            color: #000;
        }

        .status-negative {
            color: #dc3545;
        }

        .zoom-controls-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .usage-hint {
            font-size: 11px;
            color: #666;
        }

        .zoom-buttons {
            display: flex;
            gap: 4px;
        }

        .zoom-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
        }

        .zoom-btn:hover {
            background: #0056b3;
        }

        #diagram {
            flex: 1;
            overflow: auto;
            position: relative;
            background: #fafafa;
        }

        .zoom-level-indicator {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 1000;
        }

        .diagram-container {
            display: inline-block;
            margin: 0 auto;
            transform-origin: center center;
            transition: transform 0.3s ease;
        }

        .mermaid {
            text-align: center;
        }

        .legend {
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
            padding: 10px;
            flex-shrink: 0;
            max-height: 100px;
            overflow-y: auto;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 6px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px;
            background: white;
            border-radius: 3px;
            border: 1px solid #dee2e6;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            flex-shrink: 0;
        }

        .legend-text {
            font-size: 11px;
            line-height: 1.2;
        }

        /* Legend colors matching the diagram */
        .color-external { background-color: #e1f5fe; border: 1px solid #01579b; }
        .color-server { background-color: #f3e5f5; border: 1px solid #4a148c; }
        .color-api { background-color: #e8f5e8; border: 1px solid #1b5e20; }
        .color-dao { background-color: #fff3e0; border: 1px solid #e65100; }
        .color-entity { background-color: #fce4ec; border: 1px solid #880e4f; }
        .color-database { background-color: #f1f8e9; border: 1px solid #33691e; }
        .color-security { background-color: #fff8e1; border: 1px solid #ff6f00; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>OpenLiberty RealWorld Example App Architecture</h1>
            <p>System Architecture Diagram</p>
        </div>

        <div class="zoom-controls">
            <div class="status-message status-positive">Click components/boxes below to view source files on GitHub</div>
            <div class="zoom-controls-group">
                <span class="usage-hint">Use Ctrl/Cmd + mouse wheel or keyboard (+/- keys) to zoom</span>
                <div class="zoom-buttons">
                    <button class="zoom-btn" onclick="zoomIn()">+ Zoom In</button>
                    <button class="zoom-btn" onclick="zoomOut()">- Zoom Out</button>
                    <button class="zoom-btn" onclick="resetZoom()">Reset</button>
                </div>
            </div>
        </div>

        <div id="diagram">
            <div class="zoom-level-indicator" id="zoomIndicator">25%</div>
            <div class="diagram-container">
                <div class="mermaid">
flowchart TD
    %% External Layer
    Client["üåê Client Applications<br/>(Web/Mobile)"]
    Frontend["üé® Frontend Application<br/>(React/Angular)"]
    
    %% API Gateway Layer
    Liberty["üöÄ Open Liberty Server<br/>v20.0.0.4"]
    CORS["üîÑ CORS Configuration<br/>(localhost:4100)"]
    Health["‚ù§Ô∏è MicroProfile Health<br/>(/health endpoint)"]
    
    %% Authentication Layer
    JWT["üîê JWT Authentication<br/>(MicroProfile JWT)"]
    JWTGen["üîë JWT Generator<br/>(Custom Issuer)"]
    
    %% REST API Layer
    subgraph "REST API Endpoints"
        UsersAPI["üë§ Users API<br/>(Registration/Login)"]
        ArticlesAPI["üìù Articles API<br/>(CRUD Operations)"]
        ProfilesAPI["üë• Profiles API<br/>(Follow/Unfollow)"]
        TagsAPI["üè∑Ô∏è Tags API<br/>(Content Categories)"]
        CommentsAPI["üí¨ Comments API<br/>(Article Discussion)"]
    end
    
    %% Business Logic Layer
    subgraph "Data Access Layer"
        UserDao["üë§ User DAO<br/>(User Operations)"]
        ArticleDao["üìù Article DAO<br/>(Article Operations)"]
        UserContext["üîÑ User Context<br/>(Business Logic)"]
    end
    
    %% Data Model Layer
    subgraph "JPA Entities"
        UserEntity["üë§ User Entity<br/>(Authentication Data)"]
        ArticleEntity["üìù Article Entity<br/>(Content Data)"]
        CommentEntity["üí¨ Comment Entity<br/>(Discussion Data)"]
        ProfileEntity["üë• Profile Entity<br/>(Public Display)"]
    end
    
    %% Persistence Layer
    JPA["üóÉÔ∏è JPA 2.2<br/>(EclipseLink)"]
    Derby["üóÑÔ∏è Derby Database<br/>(Embedded)"]
    
    %% External Integration
    Slugify["üîó Slugify Library<br/>(URL Generation)"]
    
    %% Flow Connections
    Client --> Liberty
    Frontend --> Liberty
    Liberty --> CORS
    Liberty --> Health
    Liberty --> JWT
    JWT --> JWTGen
    
    Liberty --> UsersAPI
    Liberty --> ArticlesAPI
    Liberty --> ProfilesAPI
    Liberty --> TagsAPI
    Liberty --> CommentsAPI
    
    UsersAPI --> UserDao
    ArticlesAPI --> ArticleDao
    ArticlesAPI --> UserContext
    ProfilesAPI --> UserContext
    CommentsAPI --> ArticleDao
    
    UserDao --> JPA
    ArticleDao --> JPA
    UserContext --> JPA
    
    JPA --> UserEntity
    JPA --> ArticleEntity
    JPA --> CommentEntity
    JPA --> ProfileEntity
    
    JPA --> Derby
    
    ArticlesAPI --> Slugify
    
    %% Click Events to GitHub Repository
    click Liberty href "https://github.com/jiteshy/openliberty-realworld-example-app/blob/main/src/main/liberty/config/server.xml" _blank
    click Health href "https://github.com/jiteshy/openliberty-realworld-example-app/blob/main/src/main/java/application/rest/HealthEndpoint.java" _blank
    click JWTGen href "https://github.com/jiteshy/openliberty-realworld-example-app/blob/main/src/main/java/security/JwtGenerator.java" _blank
    click UsersAPI href "https://github.com/jiteshy/openliberty-realworld-example-app/blob/main/src/main/java/application/rest/UsersAPI.java" _blank
    click ArticlesAPI href "https://github.com/jiteshy/openliberty-realworld-example-app/blob/main/src/main/java/application/rest/ArticlesAPI.java" _blank
    click ProfilesAPI href "https://github.com/jiteshy/openliberty-realworld-example-app/blob/main/src/main/java/application/rest/ProfilesAPI.java" _blank
    click TagsAPI href "https://github.com/jiteshy/openliberty-realworld-example-app/blob/main/src/main/java/application/rest/TagsAPI.java" _blank
    click UserDao href "https://github.com/jiteshy/openliberty-realworld-example-app/blob/main/src/main/java/dao/UserDao.java" _blank
    click ArticleDao href "https://github.com/jiteshy/openliberty-realworld-example-app/blob/main/src/main/java/dao/ArticleDao.java" _blank
    click UserContext href "https://github.com/jiteshy/openliberty-realworld-example-app/blob/main/src/main/java/dao/UserContext.java" _blank
    click UserEntity href "https://github.com/jiteshy/openliberty-realworld-example-app/blob/main/src/main/java/core/user/User.java" _blank
    click ArticleEntity href "https://github.com/jiteshy/openliberty-realworld-example-app/blob/main/src/main/java/core/article/Article.java" _blank
    click CommentEntity href "https://github.com/jiteshy/openliberty-realworld-example-app/blob/main/src/main/java/core/comments/Comment.java" _blank
    click ProfileEntity href "https://github.com/jiteshy/openliberty-realworld-example-app/blob/main/src/main/java/core/user/Profile.java" _blank
    click JPA href "https://github.com/jiteshy/openliberty-realworld-example-app/blob/main/src/main/resources/META-INF/persistence.xml" _blank
    click Derby href "https://github.com/jiteshy/openliberty-realworld-example-app/blob/main/pom.xml" _blank
    
    %% Styling
    classDef external fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef server fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef api fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef dao fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef entity fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef database fill:#f1f8e9,stroke:#33691e,stroke-width:2px
    classDef security fill:#fff8e1,stroke:#ff6f00,stroke-width:2px
    
    class Client,Frontend external
    class Liberty,CORS,Health server
    class UsersAPI,ArticlesAPI,ProfilesAPI,TagsAPI,CommentsAPI api
    class UserDao,ArticleDao,UserContext dao
    class UserEntity,ArticleEntity,CommentEntity,ProfileEntity entity
    class JPA,Derby database
    class JWT,JWTGen,Slugify security
                </div>
            </div>
        </div>

        <div class="legend">
            <div class="legend-grid">
                <div class="legend-item">
                    <div class="legend-color color-external"></div>
                    <span class="legend-text">External Clients</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color color-server"></div>
                    <span class="legend-text">Server Layer</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color color-api"></div>
                    <span class="legend-text">REST API</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color color-dao"></div>
                    <span class="legend-text">Data Access</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color color-entity"></div>
                    <span class="legend-text">JPA Entities</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color color-database"></div>
                    <span class="legend-text">Database</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color color-security"></div>
                    <span class="legend-text">Security/Utils</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Mermaid with loose security for GitHub links
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: { 
                useMaxWidth: false, 
                htmlLabels: true 
            },
            securityLevel: 'loose'
        });

        // Zoom functionality
        let zoomLevel = 0.25;
        const minZoom = 0.15;
        const maxZoom = 3;
        const zoomStep = 0.25;

        function updateZoom() {
            const container = document.querySelector('.diagram-container');
            const indicator = document.getElementById('zoomIndicator');
            container.style.transform = `scale(${zoomLevel})`;
            indicator.textContent = Math.round(zoomLevel * 100) + '%';
        }

        function zoomIn() {
            if (zoomLevel < maxZoom) {
                zoomLevel = Math.min(zoomLevel + zoomStep, maxZoom);
                updateZoom();
            }
        }

        function zoomOut() {
            if (zoomLevel > minZoom) {
                zoomLevel = Math.max(zoomLevel - zoomStep, minZoom);
                updateZoom();
            }
        }

        function resetZoom() {
            zoomLevel = 0.25;
            updateZoom();
            setTimeout(centerDiagram, 100);
        }

        function centerDiagram() {
            const diagramElement = document.getElementById('diagram');
            const containerWidth = diagramElement.scrollWidth;
            const containerHeight = diagramElement.scrollHeight;
            const viewWidth = diagramElement.clientWidth;
            const viewHeight = diagramElement.clientHeight;
            
            diagramElement.scrollLeft = (containerWidth - viewWidth) / 2;
            diagramElement.scrollTop = (containerHeight - viewHeight) / 2;
        }

        // Keyboard support
        document.addEventListener('keydown', function(e) {
            // Only zoom if not typing in an input field
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            
            if (e.key === '+' || e.key === '=') {
                e.preventDefault();
                zoomIn();
            } else if (e.key === '-') {
                e.preventDefault();
                zoomOut();
            } else if (e.key === '0') {
                e.preventDefault();
                resetZoom();
            }
        });

        // Mouse wheel zoom support
        document.getElementById('diagram').addEventListener('wheel', function(e) {
            if (e.ctrlKey || e.metaKey) {
                e.preventDefault();
                if (e.deltaY < 0) {
                    zoomIn();
                } else {
                    zoomOut();
                }
            }
        });

        // Initialize on page load
        window.addEventListener('load', function() {
            updateZoom();
            setTimeout(centerDiagram, 500);
        });
    </script>
</body>
</html> 